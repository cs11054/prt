package models

import util.XMLConv

object FamillyNames extends XMLConv {

  private val fnameMap = scala.collection.concurrent.TrieMap.empty[String, String]
  private val SAVE_NAME = "fmnm.xml"

  case class KeyAndValue(key: String, value: String) {
    def toXML = <key>{ key }</key>
                <value>{ value }</value>
  }

  def load(path: String) {
    val list = readXML(path + SAVE_NAME) { node =>
      val key = (node \ "key").text
      val value = (node \ "value").text
      KeyAndValue(key, value)
    }
    for (kv <- list) fnameMap.put(kv.key, kv.value)
  }

  def save(path: String = "") {
    writeXML(path + SAVE_NAME, fnameMap.map(kv => KeyAndValue(kv._1, kv._2)).toList)
  }

  def allDel() {
    fnameMap.clear
  }

  def anony2famname(n: String): String = fnameMap.get(n) match {
    case Some(x) => x
    case None =>
      val name = getFname() match {
        case Left(x) => n
        case Right(x) => x + "さん"
      }
      fnameMap.put(n, name)
      name
  }

  private def getFname(): Either[java.lang.IndexOutOfBoundsException, String] = {
    try {
      Right(fn.remove(0))
    } catch {
      case e: java.lang.IndexOutOfBoundsException =>
        println(e)
        Left(e)
    }
  }

  private val fn = scala.collection.mutable.Buffer(
    "明壁",
    "璃吉",
    "秋津",
    "浅井田",
    "璃岡",
    "麻霧",
    "浅生",
    "穐沢",
    "合坂",
    "明尾",
    "朱阪",
    "阿久",
    "穐原",
    "淳岡",
    "朱羽根",
    "藍木",
    "紅堀",
    "会川",
    "明間",
    "藍島",
    "淳河",
    "阿河",
    "朝妻",
    "相崎",
    "朱比",
    "緋間",
    "麻熊",
    "朱野",
    "麻賀",
    "藍知",
    "青",
    "赤兄",
    "明井",
    "吾河",
    "愛馬",
    "浅積",
    "秋貞",
    "緋田",
    "明桐",
    "朱羽",
    "逢沢",
    "朱星",
    "朱松",
    "紅城",
    "紅沢",
    "阿後",
    "愛坂",
    "旦",
    "昭本",
    "浅霞",
    "昭浜",
    "愛曽",
    "朝口",
    "青垣",
    "藍甲",
    "璃間",
    "合阪",
    "赤谷",
    "浅薙",
    "愛宮",
    "青笹",
    "昭村",
    "合賀",
    "紅田",
    "朱津",
    "青峰",
    "秋保",
    "秋島",
    "璃谷",
    "穐間",
    "会羽",
    "昭澤",
    "明羽",
    "淳草",
    "浅古",
    "麻",
    "赤桐",
    "挙田",
    "昭谷",
    "紅桐",
    "阿久",
    "朱間",
    "朱瀬",
    "明塩",
    "明碕",
    "藍磯",
    "会原",
    "朱紙",
    "淳場",
    "明嶋",
    "相坂",
    "朱尾杉",
    "淳川",
    "昭池",
    "藍庭",
    "相野",
    "浅貝",
    "昭草",
    "淳島",
    "璃川",
    "会原",
    "朱見",
    "緋居",
    "明瀬",
    "紅上",
    "朱浜",
    "淳成",
    "藍賀",
    "麻霞",
    "安川",
    "明神",
    "愛作",
    "藍坂",
    "朝薙",
    "会野谷",
    "穐田",
    "秋池",
    "愛尾",
    "朱沼",
    "藍之谷",
    "麻吉",
    "麻羽",
    "愛川",
    "青土",
    "璃葉",
    "秋月",
    "明碕",
    "愛須",
    "明林",
    "紅碕",
    "璃原",
    "明木",
    "渥",
    "明城",
    "秋場",
    "明崎",
    "紅桐",
    "麻妻",
    "阿賀嶺",
    "穐和",
    "緋池",
    "昭口",
    "朱神",
    "赤湯",
    "姶良",
    "赤嶋",
    "麻羽",
    "麻塚",
    "明田",
    "璃河",
    "合知",
    "秋桝",
    "浅寺",
    "藍内",
    "赤桐",
    "淳津",
    "紅塚",
    "昭浜",
    "会生",
    "合尾",
    "麻長",
    "藍希",
    "淳庭",
    "紅荻",
    "朱穂",
    "相馬",
    "朱威",
    "会甲",
    "饗場",
    "阿岐",
    "吾久井",
    "淳場",
    "吾妻",
    "秋葉原",
    "赤楚",
    "青杜",
    "麻寺",
    "昭津",
    "淳田",
    "相乃谷",
    "安加賀",
    "愛洲",
    "愛築",
    "藍羽",
    "青鹿",
    "淳吉",
    "会庭",
    "璃田",
    "明塚",
    "合川",
    "赤坂",
    "昭間",
    "朱山",
    "合嶋",
    "璃成",
    "明沢",
    "昭場",
    "璃保",
    "愛木",
    "麻葉",
    "昭川",
    "淳草",
    "淳保",
    "藍住",
    "浅長",
    "哀公",
    "会磯",
    "粟生",
    "赤塚",
    "安居",
    "相内",
    "浅貝",
    "阿賀",
    "紅羽",
    "淳保",
    "穐浜",
    "愛乃谷",
    "紅澤",
    "東盛",
    "浅治",
    "亜伊",
    "耀",
    "青田",
    "麻口",
    "明須",
    "淳里",
    "合築",
    "愛希",
    "紅名",
    "昭庭",
    "緋積",
    "青渡",
    "明羽根",
    "璃保",
    "安佐",
    "淳葉原",
    "璃島",
    "紅城",
    "青崎",
    "会之谷",
    "昭河",
    "秋田川",
    "浅羽",
    "穐島",
    "紅谷",
    "紅羽",
    "藍乃谷",
    "赤工",
    "赤田",
    "会島",
    "朝浪",
    "明野",
    "朝田",
    "藍尾",
    "日外",
    "会作",
    "赤城",
    "璃口",
    "麻立",
    "朝寺",
    "朝朝川",
    "紅岩",
    "会崎",
    "朱荻",
    "阿育",
    "明澤",
    "愛橘",
    "青尾",
    "穐定",
    "藍木",
    "吾久",
    "相築",
    "藍崎",
    "麻積",
    "浅影",
    "淳根",
    "朝上",
    "秋原",
    "朝古",
    "穐木",
    "紅木",
    "紅神",
    "穐篠",
    "璃月",
    "青塚",
    "朱間",
    "赤羽",
    "明田川",
    "会浦",
    "昭根",
    "赤賀",
    "朱川",
    "藍川",
    "相去",
    "赤埴",
    "穐成",
    "朱塩",
    "会馬",
    "淳野",
    "吾木",
    "会嶋",
    "紅井",
    "阿嘉嶺",
    "青菜",
    "璃庭",
    "璃場",
    "会賀",
    "朱嶋",
    "麻来",
    "明堀",
    "合葉",
    "鮎川",
    "秋河",
    "相阪",
    "璃本",
    "赤穴",
    "朱壁",
    "淳森",
    "藍野谷",
    "藍嶋",
    "藍坂",
    "朱阪",
    "相賀",
    "昭保",
    "穐里",
    "合磯",
    "藍崎",
    "穐口",
    "穐沢",
    "明岡",
    "藍葉",
    "藍作",
    "阿久比",
    "明田",
    "昭月",
    "淳里",
    "朱谷",
    "朱城",
    "穐原",
    "紅須",
    "赤荻",
    "紅平",
    "暁枝",
    "赤羽",
    "麻治",
    "明桐",
    "青嶋",
    "朱沢",
    "昭草",
    "昭元",
    "淳篠",
    "吾久澤",
    "安居院",
    "穐草",
    "明穂",
    "会宮",
    "穐保",
    "相川",
    "紅阪",
    "秋枝",
    "哀宮",
    "昭河",
    "会作",
    "青笹",
    "昭保",
    "麻影",
    "璃津",
    "明沼",
    "璃貞",
    "丹下",
    "亜久",
    "璃庭",
    "明羽根",
    "朝塚",
    "明河",
    "昭川",
    "朝吉",
    "昭定",
    "相尾",
    "穐庭",
    "相知",
    "紅賀",
    "朱桐",
    "合曽",
    "朝治",
    "朱堀",
    "合野谷",
    "璃河",
    "秋和",
    "藍築",
    "淳木",
    "朱澤",
    "浅加",
    "秋河",
    "合嶋",
    "淳庭",
    "昭沢",
    "会乃谷",
    "朝茅",
    "明羽",
    "緋田",
    "会坂",
    "朱林",
    "明倉",
    "紅沢",
    "淳原",
    "昭谷",
    "朱石",
    "璃根",
    "明山",
    "麻加",
    "赤阪",
    "緋野",
    "会崎",
    "明谷",
    "朝積",
    "青島",
    "愛木",
    "龝山",
    "藍嶋",
    "朝井田",
    "明城",
    "朝立",
    "璃元",
    "明山",
    "明星",
    "朱羽",
    "合野",
    "紅羽",
    "愛山",
    "昭里",
    "青沢",
    "紅崎",
    "会内",
    "浅立",
    "璃津",
    "明平",
    "合作",
    "相甲",
    "璃池",
    "穐保",
    "紅湯",
    "淳村",
    "麻海",
    "粟生",
    "亜久澤",
    "揚松",
    "青川",
    "東里",
    "明枝",
    "吾木",
    "昭田",
    "蒼",
    "飽浦",
    "相之谷",
    "浅霧",
    "吾岐",
    "穐葉原",
    "璃澤",
    "赤石",
    "朱羽根",
    "紅田",
    "明星",
    "淳貞",
    "紅星",
    "赤名",
    "朱根",
    "安久",
    "赤尾杉",
    "明坂",
    "明嶋",
    "紅塚",
    "璃場",
    "淳月",
    "会築",
    "英田",
    "明堀",
    "我妻",
    "麻野間",
    "淳田谷",
    "穐野",
    "明根",
    "璃定",
    "吾久澤",
    "浅立",
    "朱岩",
    "緋野",
    "相木",
    "朱星",
    "明積",
    "明荻",
    "紅沼",
    "璃田",
    "明城",
    "朱坂",
    "明木",
    "吾郷",
    "璃山",
    "淳桝",
    "阿久井",
    "藍作",
    "安河山",
    "昭島",
    "吾久",
    "青戸",
    "藍村",
    "紅崎",
    "穐河",
    "淳澤",
    "合生",
    "紅碕",
    "明阪",
    "上場",
    "青本",
    "紅谷",
    "穐津",
    "朱平",
    "麻上",
    "哀宗",
    "赤城",
    "紅星",
    "麻生",
    "赤紙",
    "淳池",
    "浅塚",
    "紅瀬",
    "紅間",
    "璃葉原",
    "亜久澤",
    "穐月",
    "青渡",
    "明賀",
    "璃森",
    "縣",
    "明峰",
    "赤塩",
    "赤丸",
    "揚田",
    "穐草",
    "昭沢",
    "挙場",
    "秋葉",
    "淳川",
    "朱居",
    "明木",
    "浅熊",
    "朱碕",
    "会希",
    "青砥",
    "穐島",
    "穐河",
    "昭葉",
    "穐根",
    "紅坂",
    "亜木",
    "昭原",
    "赤萩",
    "朱湯",
    "浅浅川",
    "赤津",
    "璃草",
    "麻日",
    "淳浜",
    "紅坂",
    "吾久井",
    "愛野",
    "浅来",
    "愛賀",
    "愛庭",
    "阿賀野",
    "藍生",
    "紅川",
    "麻立",
    "朱楚",
    "穐澤",
    "吾川",
    "明尾杉",
    "朱井",
    "昭篠",
    "明間",
    "赤鹿",
    "淳庭",
    "淳谷",
    "亜古",
    "相戸",
    "麻田",
    "明瀬",
    "合島",
    "青川",
    "紅塩",
    "紅嶺",
    "愛磯",
    "朝立",
    "青澤",
    "淳定",
    "青笹",
    "淳沢",
    "相去",
    "紅塩",
    "愛野谷",
    "合磯",
    "淳山",
    "麻麻川",
    "紅峰",
    "昭葉原",
    "愛染",
    "璃草",
    "藍島",
    "浅田",
    "浅浪",
    "昭吉",
    "藍見",
    "秋川",
    "阿尾",
    "安河",
    "緋比",
    "赤染",
    "吾河",
    "明崎",
    "青柿",
    "赤塩",
    "紅楚",
    "明田",
    "明谷",
    "朱城",
    "合染",
    "浅上",
    "明沢",
    "相槻",
    "愛生",
    "紅石",
    "昭里",
    "穐里",
    "朱田",
    "明田",
    "朝草",
    "揚田",
    "合崎",
    "青鹿",
    "相磯",
    "合羽",
    "淳谷",
    "明名",
    "朱塚",
    "会島",
    "淳田",
    "昭津",
    "明塚",
    "挙石",
    "青名",
    "青墓",
    "合乃谷",
    "紅倉",
    "昭和",
    "合木",
    "朱羽",
    "亜久沢",
    "朱城",
    "紅羽根",
    "碧",
    "亜岸",
    "亜久井",
    "昭庭",
    "淳元",
    "朝葉",
    "朝上",
    "朱木",
    "亜久沢",
    "麻井田",
    "安川",
    "明坂",
    "明津",
    "明塩",
    "相作",
    "秋保",
    "紅阪",
    "紅尾杉",
    "藍那",
    "合見",
    "璃月",
    "愛嶋",
    "朱田",
    "合賀",
    "相築",
    "璃枝",
    "上石",
    "璃沢",
    "明羽",
    "穐庭",
    "璃篠",
    "亜久井",
    "璃里",
    "紅穂",
    "会嶋",
    "赤橋",
    "愛羽",
    "会賀",
    "淳間",
    "紅居",
    "朱塩",
    "晶枝",
    "朱嶺",
    "昭森",
    "会野",
    "藍染",
    "穐場",
    "朱倉",
    "合木",
    "明紙",
    "朝熊",
    "昭原",
    "朝海",
    "吾久沢",
    "朱碕",
    "麻茅",
    "朱峰",
    "明上",
    "碧野",
    "麻茅",
    "淳成",
    "紅見",
    "穐保",
    "秋",
    "会野",
    "朝茅",
    "亜岐",
    "朱須",
    "藍場",
    "朱嶋",
    "合戸",
    "昭貞",
    "淳枝",
    "愛崎",
    "秋浜",
    "赤染",
    "璃葉",
    "紅峯",
    "合之谷",
    "朝生",
    "麻立",
    "阿川",
    "秋草",
    "昭山",
    "明川",
    "朝立",
    "朱峯",
    "顕家",
    "璃成",
    "璃保",
    "愛嶋",
    "明羽",
    "麻古",
    "愛島",
    "朝立",
    "緋井",
    "藍馬",
    "淳保",
    "朝羽",
    "会尾",
    "合馬",
    "朱澤",
    "昭田谷",
    "相家",
    "淳島",
    "朱岡",
    "璃川",
    "明岩",
    "明比",
    "朱谷",
    "上田",
    "青土",
    "淳葉",
    "安護",
    "璃島",
    "朱羽",
    "淳原",
    "明川",
    "青方",
    "朱塚",
    "丹",
    "麻羽",
    "青都",
    "朱賀",
    "亜久",
    "会坂",
    "会曽",
    "麻海",
    "紅澤",
    "淳本",
    "朱尾",
    "昭保",
    "揚石",
    "穐成",
    "相賀",
    "朝場",
    "穐元",
    "朱野",
    "璃谷",
    "淳浜",
    "紅嶋",
    "愛島",
    "哀見",
    "朱崎",
    "穐津",
    "藍曽",
    "浅立",
    "昭成",
    "挙松",
    "朱名",
    "淳河",
    "愛見",
    "明峯",
    "秋里",
    "紅岡",
    "藍野",
    "朝塚",
    "紅羽根",
    "阿久井",
    "麻枝",
    "麻生",
    "紅尾",
    "朱坂",
    "麻地",
    "藍宮",
    "璃村",
    "浅妻",
    "愛崎",
    "朱田",
    "穐桝",
    "昭田",
    "穐庭",
    "麻塚",
    "明石家",
    "朱上",
    "朱智",
    "璃木",
    "紅山",
    "亜木",
    "赤浜",
    "相中",
    "上松",
    "緋浜",
    "浅立",
    "挙尾",
    "会葉",
    "愛之谷",
    "藍賀",
    "明阪",
    "璃庭",
    "合内",
    "合希",
    "朱城",
    "愛津",
    "哀帝",
    "穐川",
    "明嶺",
    "紅羽",
    "秋田",
    "明松",
    "昭野",
    "吾岸",
    "淳口",
    "昭島",
    "赤山",
    "浅吉",
    "穐森",
    "浅塚",
    "穐川",
    "紅壁",
    "璃田谷",
    "愛磯",
    "浅羽",
    "赤嶋",
    "藍津",
    "淳葉",
    "合宮",
    "青鹿",
    "紅松",
    "秋木",
    "昭岡",
    "明見",
    "明楚",
    "愛内",
    "緋智",
    "安河",
    "昭場",
    "明河",
    "麻草",
    "相作",
    "明湯",
    "朱田",
    "吾久沢",
    "璃桝",
    "愛坂",
    "会木",
    "穐浜",
    "淳月",
    "合作",
    "紅城",
    "合津",
    "穐田谷",
    "紅津",
    "璃浜",
    "麻立",
    "朱池",
    "逢澤",
    "紅池",
    "紅根",
    "昭桝",
    "麻妻",
    "合野",
    "朱沢",
    "穐池",
    "麻浪",
    "紅木",
    "秋島",
    "璃里",
    "逢崎",
    "朱火",
    "秋森",
    "朱積",
    "愛賀",
    "紅城",
    "東門",
    "合原",
    "餐場",
    "阿骨打",
    "璃原",
    "合甲",
    "会染",
    "青地",
    "赤羽根",
    "朱崎",
    "麻薙",
    "璃浜",
    "会知",
    "麻比奈",
    "淳沢",
    "藍磯",
    "璃野",
    "東盛",
    "穐場",
    "朱堀",
    "秋成",
    "明下",
    "朝海",
    "合島",
    "藍浦",
    "愛作",
    "青谷",
    "昭成",
    "朝羽",
    "昭木",
    "穐葉",
    "相染",
    "青芝",
    "朱桐",
    "紅紙",
    "紅嶋",
    "揚尾",
    "会磯",
    "穐谷",
    "淳津",
    "昭庭",
    "昭月",
    "愛浦",
    "璃沢",
    "穐貞",
    "昭葉",
    "赤上",
    "朱木",
    "紅堀",
    "明澤")
}